<div class="datepicker">
  <div class="datepicker__header">
    <button class="arrow-button" (click)="switchToPreviousMonth($event)">
      <pupa-icon name="ios-arrow-back"></pupa-icon>
    </button>
    <span class="month">
      {{ primarySectionStartDate$ | async | date: 'LLLL yyy' | titlecase }}
    </span>
    <button class="arrow-button" (click)="switchToNextMonth($event)">
      <pupa-icon name="ios-arrow-forward"></pupa-icon>
    </button>
  </div>

  <div class="datepicker__week-days">
    <span class="week-day" *ngFor="let dayName of weekDayNames">
      {{ dayName }}
    </span>
  </div>

  <div class="datepicker__dates">
    <ng-container
      [ngTemplateOutlet]="dateButton"
      [ngTemplateOutletContext]="{
        dateOrigin: primarySectionLeftOffsetDates$ | async,
        isPreviousMonth: true
      }"
    ></ng-container>

    <ng-container
      [ngTemplateOutlet]="dateButton"
      [ngTemplateOutletContext]="{
        dateOrigin: primarySectionDates$ | async,
        isPreviousMonth: false
      }"
    ></ng-container>
  </div>
</div>

<ng-template #dateButton let-dateOrigin="dateOrigin" let-isPreviousMonth="isPreviousMonth">
  <button
    class="date"
    [ngClass]="{
      'date_previous-month': isPreviousMonth,
      date_hovered: isSameDate(date, hoveredDate$ | async),
      'date_in-range':
        !isDateSelectionMode &&
        (dateIsInDateRange(date, selectedRange$ | async) || dateIsInDateRange(date, hoveredRange$ | async)),
      date_selected: isDateSelectionMode
        ? isSameDate(date, selectedDate$ | async)
        : dateIsInDateArray(date, selectedRange$ | async)
    }"
    *ngFor="let date of dateOrigin"
    (mouseover)="processDateHover(date, $event)"
    (click)="processDateSelection(date, $event)"
  >
    {{ date | date: 'd' }}
  </button>
</ng-template>
