<div class="base-input-container date" [class.fixed-size]="isFixedSize$ | async">
  <pupa-droppable #droppable>
    <pupa-droppable-trigger class="dropdown-trigger">
      <div
        class="time-input-container"
        [class.table-mode]="isTableMode$ | async"
        (click)="handleContainerClick($event)"
        (mousedown)="handleContainerStartEvents($event)"
      >
        <div class="time-input-container__placeholder">
          <span class="left">{{ placeholderPreviewLeft$ | async }}</span>
          <span class="right">{{ placeholderPreviewRight$ | async }}</span>
        </div>
        <!-- NOTE: ngModel is incorrect: use other mask instead -->
        <input
          class="input"
          #inputElement
          type="text"
          placeholder=""
          [mask]="'00.00.0000 00:00'"
          [maxLength]="maxLengthInputValue"
          [attr.disabled]="(isDisabled$ | async) ? true : null"
          [ngClass]="{
            input__invalid: (isTouched$ | async) && !(isValid$ | async) && !(isDisabled$ | async),
            input__medium: size === 'medium',
            input__small: size === 'small',
            input__large: size === 'large',
            input__transparent: transparent,
            input__focused: (isFocused$ | async) || droppable.isOpened
          }"
          (input)="updateValue(inputElement.value)"
          (focus)="emitFocusEvent($event)"
          (blur)="emitBlurEvent($event)"
          [autocomplete]="autocomplete ? 'on' : 'off'"
          [value]="value$ | async"
          [ngModel]="value$ | async"
        />
        <div
          class="time-input-container__icon"
          [class.focused]="(isFocused$ | async) || droppable.isOpened"
          [class.disabled]="isDisabled$ | async"
          (mouseenter)="handleIconHover(true)"
          (mouseleave)="handleIconHover(false)"
          (mousemove)="$event.stopPropagation()"
          (click)="clearInputValue()"
        >
          <ng-container
            *ngIf="(isTouched$ | async) && !(isValid$ | async) && !(isDisabled$ | async); else staticIconsTemplate"
          >
            <pupa-icon class="error-icon" name="md-alert" [title]="errorTitle$ | async"></pupa-icon>
          </ng-container>
        </div>
      </div>
    </pupa-droppable-trigger>
    <pupa-droppable-native-content>
      <pupa-date-picker
        *ngIf="droppable.isOpened"
        [selectedDate]="date$ | async"
        [selectionMode]="'date'"
        [isBackDating]="isBackDating$ | async"
        [availableEndDate]="availableEndDate$ | async"
        [hours]="hours$ | async"
        [minutes]="minutes$ | async"
        (selectedHours)="selectDateTimeHours($event)"
        (selectedMinutes)="selectDateTimeMinutes($event)"
        (click)="handleFocusEvent($event)"
        (date)="selectDate($event)"
        [previewMode]="'simple-time'"
      ></pupa-date-picker>
    </pupa-droppable-native-content>
  </pupa-droppable>
</div>

<ng-template #staticIconsTemplate>
  <ng-container
    *ngIf="(isIconHovered$ | async) && (valueIsNotEmpty$ | async) && !(isDisabled$ | async); else defaultTemplate"
  >
    <pupa-icon name="md-close-circle"></pupa-icon>
  </ng-container>
</ng-template>

<ng-template #defaultTemplate>
  <pupa-icon name="ios-calendar"></pupa-icon>
</ng-template>
