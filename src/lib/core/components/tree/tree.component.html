<cdk-virtual-scroll-viewport *ngIf="configuration" itemSize="28" class="viewport" #viewPort>
  <ng-container *cdkVirtualFor="let item of dataOrigin$ | async"></ng-container>

  <cdk-tree [dataSource]="dataSource$ | async" [treeControl]="treeControl$ | async">
    <cdk-tree-node
      *cdkTreeNodeDef="let node; when: hasNoChild"
      [cdkTreeNodeToggleRecursive]="true"
      [cdkTreeNodePaddingIndent]="10"
      cdkTreeNodePadding
      class="tree-node-row"
    >
      <div class="tree-node">
        <div class="tree-node__expansion-button" cdkTreeNodeToggle>
          <ng-container
            [ngTemplateOutlet]="defaultExpansionButtonTemplate"
            [ngTemplateOutletContext]="{
              node: node,
              hasChild: false
            }"
          ></ng-container>
        </div>

        <ng-container
          [ngTemplateOutlet]="defaultNodeTemplate"
          [ngTemplateOutlet]="defaultNodeTemplate"
          [ngTemplateOutletContext]="{
            node: node
          }"
        ></ng-container>
      </div>
    </cdk-tree-node>

    <cdk-tree-node
      *cdkTreeNodeDef="let node; when: hasChild"
      [cdkTreeNodeToggleRecursive]="true"
      [cdkTreeNodePaddingIndent]="10"
      cdkTreeNodePadding
      class="tree-node-row"
    >
      <div class="tree-node">
        <div class="tree-node__expansion-button" cdkTreeNodeToggle>
          <ng-container
            [ngTemplateOutlet]="defaultExpansionButtonTemplate"
            [ngTemplateOutletContext]="{
              node: node,
              hasChild: true
            }"
          ></ng-container>
        </div>

        <ng-container
          [ngTemplateOutlet]="defaultNodeTemplate"
          [ngTemplateOutletContext]="{
            node: node
          }"
        ></ng-container>
      </div>
    </cdk-tree-node>
  </cdk-tree>
</cdk-virtual-scroll-viewport>

<ng-template #defaultNodeTemplate let-node="node">
  {{ node?.name }}
</ng-template>

<ng-template #defaultExpansionButtonTemplate let-node="node" let-hasChild="hasChild">
  <button class="default-expansion-button" [disabled]="!hasChild">
    <ion-icon [name]="(treeControl$ | async).isExpanded(node) ? 'ios-arrow-down' : 'ios-arrow-forward'"></ion-icon>
  </button>
</ng-template>
